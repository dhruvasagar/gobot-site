<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html ng-app="gobot"> <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta content="width=device-width, initial-scale=1.0" name="viewport"> <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"> <meta name="description"> <meta content="Ron Evans" name="author"> <title>Hello, Tello - Hacking Drones With Go</title> <link href="/stylesheets/application.css" rel="stylesheet"> <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script> <script src="/javascripts/vendor/angular.min.js"></script> <script src="/javascripts/app.js"></script> <script type="text/javascript">


  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46433484-3', {"cookieDomain":"gobot.io"});
















   ga('send', 'pageview');


</script></head> <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,800%7CLato:400" rel="stylesheet"> <link href="/favicon.ico" rel="shortcut icon" type="image/gif">  <body> <div class="app"> <header class="app-header" id="top" role="banner"> <div class="container"> <div class="display"> <div class="app-logo"> <a href="/">Gobot</a> </div> </div> <nav class="menu"> <ul class="nav-list"> <li> <a href="/documentation" class="item">Docs</a> </li> <li> <a href="/documentation/platforms" class="item">Platforms</a> </li> <li> <a href="/resources" class="item">Resources</a> </li> <li> <a href="/news" class="item">News</a> </li> <li> <a href="/blog" class="item">Blog</a> </li> <li> <a class="item" target="blanck" href="https://github.com/hybridgroup/gobot/">Github</a> </li> </ul> </nav> </div> </header> <div class="page-title"> <div class="container"> <h1 class="title">Blog</h1> </div> </div> <div class="main-content blog" role="main"> <div class="articles"> <div class="article"> <header class="header"> <div class="dates"> <div class="date-top"> <div class="month"> Apr </div> <div class="day"> 20 </div> </div> <div class="date-bottom"> <div class="year"> 2018 </div> </div> </div> <h3 class="article-title"> <a href="/blog/2018/04/20/hello-tello-hacking-drones-with-go/">Hello, Tello - Hacking Drones With Go</a> <br> </h3> </header> <p>The <a href="https://www.ryzerobotics.com/tello">DJI Tello</a> is a new quadcopter which combines powerful technology from <a href="https://www.dji.com/">DJI</a> and <a href="https://www.intel.com">Intel</a> into a very tiny package. We recently got our hands on a couple of these new drones, and we now have support for Gobot, so you can control the drone using the Go programming language.</p> <iframe width="560" height="315" src="https://www.youtube.com/embed/2sa9vbcNaj0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen=""></iframe> <p>For only around $99 US, it is amazing how many features are included. Like many more expensive models, the Tello connects to the ground controller via WiFi, and includes an onboard 5 megapixel HD camera along with various other sensors. </p> <p>However, what really sets the Tello apart is the 14-core processor from Intel that includes an onboard <a href="https://www.movidius.com/news/hello-tello-ryze-announces-intel-myriad-vpu-powered-toy-drone">Movidius Myriad 2</a> VPU (Video Processing Unit) for advanced imaging and vision processing.</p> <p>Despite all this cool hardware, the official Tello SDK only offers a very limited set of the drone's overall capabilities. Luckily, there is a much better API hiding under the surface for those who know how to look. This undocumented API is the one used by the official Tello Android and iOS applications.</p> <p>An <a href="https://tellopilots.com/forums/tello-development.8/">active community</a> has quickly formed around hacking the ground station and video protocols used by the Tello. Thanks to tools like <a href="https://www.wireshark.org/">Wireshark</a>, and the generous nature of open source, we've collectively already deciphered much of the protocol used by the Tello. </p> <p>We have used this knowledge to create a new driver for Gobot that lets you explore the drone's functionality, and combine it with the other capabilities of the Gobot framework, such as controlling the Tello drone with a Playstation Dualshock3 joystick.</p> <h2 id="obtaining-a-drone">Obtaining a drone</h2> <p>The initial shipments of this interesting new drone have already sold out very quickly in many places. You can purchase online via <a target="_blank" href="https://www.amazon.com/gp/product/B078YLX1XJ/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=9325&amp;creativeASIN=B078YLX1XJ&amp;linkCode=as2&amp;tag=hybridgroup-20&amp;linkId=b43ee0369c13023029902b267819681d">Amazon.com</a><img src="//ir-na.amazon-adsystem.com/e/ir?t=hybridgroup-20&amp;l=am2&amp;o=1&amp;a=B078YLX1XJ" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;">, or you can also order directly from the <a href="https://store.dji.com/shop/tello-series">DJI store</a>.</p> <h2 id="ready-for-takeoff">Ready for takeoff</h2> <p>In the Gobot implementatation, we have tried to expose the Tello API in a way that is mostly compatible with other drones that are already supported in Gobot.</p> <p>Here is an example that just takes off, and 5 seconds later, lands:</p> <pre class="CodeRay">  <span class="keyword">package</span> main

  <span class="keyword">import</span> (
      <span class="string"><span class="delimiter">"</span><span class="content">time</span><span class="delimiter">"</span></span>

      <span class="string"><span class="delimiter">"</span><span class="content">gobot.io/x/gobot</span><span class="delimiter">"</span></span>
      <span class="string"><span class="delimiter">"</span><span class="content">gobot.io/x/gobot/platforms/dji/tello</span><span class="delimiter">"</span></span>
  )

  <span class="keyword">func</span> main() {
      drone := tello.NewDriver(<span class="string"><span class="delimiter">"</span><span class="content">8888</span><span class="delimiter">"</span></span>)

      work := <span class="keyword">func</span>() {
          drone.TakeOff()

          gobot.After(<span class="integer">5</span>*time.Second, <span class="keyword">func</span>() {
              drone.Land()
          })
      }

      robot := gobot.NewRobot(<span class="string"><span class="delimiter">"</span><span class="content">tello</span><span class="delimiter">"</span></span>,
          []gobot.Connection{},
          []gobot.Device{drone},
          work,
      )

      robot.Start()
  }
</pre> <h2 id="controlling-your-flight">Controlling your flight</h2> <p>The Tello is pretty manueverable, and there are a number of different axes on which you can control the drone. Like most fly by wire devices, the control system closely parallels those used by radio control helicopters and airplanes.</p> <p>However, one big advantage of most multicopters is their stability while in-flight. This allows you to simply send flight motion commands to the drone, like "go right", and then have the drone respond relative to its original position. This is a lot easier to control then the traditional control stick of an R/C helicopter, especially if your intention is to avoid crashes while coding your drone.</p> <p>For example, instead of worrying about "yaw" or "pitch", you can just tell the drone to fly "forward" or "right" like this:</p> <pre class="CodeRay">  <span class="keyword">package</span> main

  <span class="keyword">import</span> (
      <span class="string"><span class="delimiter">"</span><span class="content">time</span><span class="delimiter">"</span></span>

      <span class="string"><span class="delimiter">"</span><span class="content">gobot.io/x/gobot</span><span class="delimiter">"</span></span>
      <span class="string"><span class="delimiter">"</span><span class="content">gobot.io/x/gobot/platforms/dji/tello</span><span class="delimiter">"</span></span>
  )

  <span class="keyword">func</span> main() {
      drone := tello.NewDriver(<span class="string"><span class="delimiter">"</span><span class="content">8888</span><span class="delimiter">"</span></span>)

      work := <span class="keyword">func</span>() {
          drone.TakeOff()

          gobot.After(<span class="integer">3</span>*time.Second, <span class="keyword">func</span>() {
              drone.Forward(<span class="integer">10</span>)
          })

          gobot.After(<span class="integer">6</span>*time.Second, <span class="keyword">func</span>() {
              drone.Backward(<span class="integer">10</span>)
          })

          gobot.After(<span class="integer">9</span>*time.Second, <span class="keyword">func</span>() {
              drone.Land()
          })
      }

      robot := gobot.NewRobot(<span class="string"><span class="delimiter">"</span><span class="content">tello</span><span class="delimiter">"</span></span>,
          []gobot.Connection{},
          []gobot.Device{drone},
          work,
      )

      robot.Start()
  }
</pre> <p>Want to do tricks? No problem, the Tello can perform flips. Here is a short example:</p> <pre class="CodeRay">  <span class="keyword">package</span> main

  <span class="keyword">import</span> (
      <span class="string"><span class="delimiter">"</span><span class="content">time</span><span class="delimiter">"</span></span>

      <span class="string"><span class="delimiter">"</span><span class="content">gobot.io/x/gobot</span><span class="delimiter">"</span></span>
      <span class="string"><span class="delimiter">"</span><span class="content">gobot.io/x/gobot/platforms/dji/tello</span><span class="delimiter">"</span></span>
  )

  <span class="keyword">func</span> main() {
      drone := tello.NewDriver(<span class="string"><span class="delimiter">"</span><span class="content">8888</span><span class="delimiter">"</span></span>)

      work := <span class="keyword">func</span>() {
          drone.TakeOff()

          gobot.After(<span class="integer">5</span>*time.Second, <span class="keyword">func</span>() {
              drone.FrontFlip()
          })

          gobot.After(<span class="integer">10</span>*time.Second, <span class="keyword">func</span>() {
              drone.BackFlip()
          })

          gobot.After(<span class="integer">15</span>*time.Second, <span class="keyword">func</span>() {
              drone.Land()
          })
      }

      robot := gobot.NewRobot(<span class="string"><span class="delimiter">"</span><span class="content">tello</span><span class="delimiter">"</span></span>,
          []gobot.Connection{},
          []gobot.Device{drone},
          work,
      )

      robot.Start()
  }
</pre> <h2 id="getting-the-messages">Getting the messages</h2> <p>The Tello sends a number of different telemetry messages back down to the ground station. For example, the current battery level and the drone's height. Take a look at the <code>tello.FlightDataEvent</code> for more information.</p> <h2 id="streaming-video">Streaming video</h2> <p>You can also view streaming video being sent from the drone to the ground station. Here is a sample that obtains the video stream from the Tello, and then displays it using the excellent open source MPlayer (<a href="https://mplayerhq.hu">https://mplayerhq.hu</a>)</p> <pre class="CodeRay">  <span class="keyword">package</span> main

  <span class="keyword">import</span> (
      <span class="string"><span class="delimiter">"</span><span class="content">fmt</span><span class="delimiter">"</span></span>
      <span class="string"><span class="delimiter">"</span><span class="content">os/exec</span><span class="delimiter">"</span></span>
      <span class="string"><span class="delimiter">"</span><span class="content">time</span><span class="delimiter">"</span></span>

      <span class="string"><span class="delimiter">"</span><span class="content">gobot.io/x/gobot</span><span class="delimiter">"</span></span>
      <span class="string"><span class="delimiter">"</span><span class="content">gobot.io/x/gobot/platforms/dji/tello</span><span class="delimiter">"</span></span>
  )

  <span class="keyword">func</span> main() {
      drone := tello.NewDriver(<span class="string"><span class="delimiter">"</span><span class="content">8890</span><span class="delimiter">"</span></span>)

      work := <span class="keyword">func</span>() {
          mplayer := exec.Command(<span class="string"><span class="delimiter">"</span><span class="content">mplayer</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">-fps</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">25</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">-</span><span class="delimiter">"</span></span>)
          mplayerIn, _ := mplayer.StdinPipe()
          <span class="keyword">if</span> err := mplayer.Start(); err != <span class="predefined-constant">nil</span> {
              fmt.Println(err)
              <span class="keyword">return</span>
          }

          drone.On(tello.ConnectedEvent, <span class="keyword">func</span>(data <span class="keyword">interface</span>{}) {
              fmt.Println(<span class="string"><span class="delimiter">"</span><span class="content">Connected</span><span class="delimiter">"</span></span>)
              drone.StartVideo()
              drone.SetVideoEncoderRate(<span class="integer">4</span>)
              gobot.Every(<span class="integer">100</span>*time.Millisecond, <span class="keyword">func</span>() {
                  drone.StartVideo()
              })
          })

          drone.On(tello.VideoFrameEvent, <span class="keyword">func</span>(data <span class="keyword">interface</span>{}) {
              pkt := data.([]<span class="predefined-type">byte</span>)
              <span class="keyword">if</span> _, err := mplayerIn.Write(pkt); err != <span class="predefined-constant">nil</span> {
                  fmt.Println(err)
              }
          })
      }

      robot := gobot.NewRobot(<span class="string"><span class="delimiter">"</span><span class="content">tello</span><span class="delimiter">"</span></span>,
          []gobot.Connection{},
          []gobot.Device{drone},
          work,
      )

      robot.Start()
  }
</pre> <p>You can also use computer vision software such as GoCV (<a href="https://gocv.io/">https://gocv.io/</a>), our Go language wrapper around <a href="https://opencv.org/">OpenCV</a> to perform face tracking and other interesting applications.</p> <h2 id="how-it-works">How it works</h2> <p>The ground station connects to the Tello drone using WiFi. The protocol to send commands to the drone uses UDP packets in a specific binary format. The responses from the drone back to the ground station likewise use UDP packets.</p> <h3 id="control-messages">Control messages</h3> <p>The packet format for the control messages, and the responses from the drone, both use the same basic format.</p> <table> <thead> <tr> <th>Position</th> <th>Usage</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>
<code>0xcc</code> indicates the start of a packet</td> </tr> <tr> <td>1-2</td> <td>Packet size, 13 bit encoded <code>([2] &lt;&lt; 8) | ([1] &gt;&gt; 3)</code>
</td> </tr> <tr> <td>3</td> <td>CRC8 of bytes 0-2</td> </tr> <tr> <td>4</td> <td>Packet type ID</td> </tr> <tr> <td>5-6</td> <td>Command ID, little endian</td> </tr> <tr> <td>7-8</td> <td>Sequence number of the packet, little endian</td> </tr> <tr> <td>9-(n-2)</td> <td>Data (if any)</td> </tr> <tr> <td>(n-1)-n</td> <td>CRC16 of bytes 0 to n-2</td> </tr> </tbody> </table> <p>So for example, the takeoff command packet looks like this:</p> <p><code>0xcc 0x58 0x00 0x7c 0x68 0x54 0x00 0xe4 0x01 0xc2 0x16</code></p> <table> <thead> <tr> <th>Value</th> <th>Usage</th> </tr> </thead> <tbody> <tr> <td><code>0xcc</code></td> <td>start of packet</td> </tr> <tr> <td><code>0x58 0x00</code></td> <td>Packet size of 11</td> </tr> <tr> <td><code>0x7c</code></td> <td>CRC8 of bytes 0-2</td> </tr> <tr> <td><code>0x68</code></td> <td>Packet type ID</td> </tr> <tr> <td><code>0x54 0x00</code></td> <td>"Takeoff" command ID, little endian</td> </tr> <tr> <td><code>0xe4 0x01</code></td> <td>Sequence number of the packet, little endian</td> </tr> <tr> <td><code>0xc2 0x16</code></td> <td>CRC16 of bytes 0 to 8</td> </tr> </tbody> </table> <h3 id="video-packets">Video packets</h3> <p>The streaming video is also sent to the ground station on a different UDP port. Unfortunately the Tello does not just use one of the existing standards for streaming video such as RTSP. Instead, the raw video packets are sent via UDP and need to be reassembled and decoded before they can be viewed.</p> <p>Since the size of a single video frame is larger than the size of a single UDP packet, the Tello breaks apart each frame, and sends the packets with header of 2 bytes to indicate how they need to be reassembled.</p> <table> <thead> <tr> <th>Position</th> <th>Usage</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>Sequence number</td> </tr> <tr> <td>1</td> <td>Sub-sequence number</td> </tr> <tr> <td>2-n</td> <td>Video data</td> </tr> </tbody> </table> <p>The video data itself is just H264 encoded YUV420p. Using this information, it is possible to decode the video using standard tools such as ffmpeg, once you remove the header bytes.</p> <h2 id="thank-you-to-the-community">Thank you to the community</h2> <p>As mentioned in the beginning of this post, the Gobot driver for the DJI Tello could not exist without the many contributions and investigation of the awesome community on the <a href="https://tellopilots.com/forums/tello-development.8/">unofficial Tello forum</a>.</p> <p>Special thanks to <a href="https://github.com/Kragrathea">@Kragrathea</a> who figured out a LOT of the packets and code as implemented in C#: <a href="https://github.com/Kragrathea/TelloPC">https://github.com/Kragrathea/TelloPC</a></p> <p>Also thanks to <a href="https://github.com/microlinux">@microlinux</a> with the Python library which served as the first example for the Tello community: <a href="https://github.com/microlinux/tello">https://github.com/microlinux/tello</a></p> <p>And <a href="https://bitbucket.org/PingguSoft">bluejune's</a> incredible work on the <a href="https://bitbucket.org/PingguSoft/pytello">https://bitbucket.org/PingguSoft/pytello</a> repo, especially the Wireshark Lua dissector for Tello which has proven indispensable.</p> <p>Last but not least, thank you <a href="https://github.com/maruel">@maruel</a> for helping figure out various Go-related video decoding questions.</p> <h2 id="keep-in-touch">Keep In Touch</h2> <p>Want to know about the latest Gobot news? Follow us on Twitter at <a href="http://twitter.com/gobotio">@gobotio</a>. Thank you!</p> <div class="blog-footer"> <h2>Contact Us</h2> <ul> <li> To stay up to date with all Gobot news, join our <a target="blank" href="https://groups.google.com/forum/#!forum/gobotio">mailing list</a> <li> If you need help or you feel we can improve something, let us know! Open a <a target="blank" href="https://github.com/hybridgroup/gobot/issues/new">new issue.</a> <li> To subscribe for announcements of releases and important changes please follow <a target="blank" href="https://twitter.com/gobotio">@gobotio</a> </ul> </div> </div> </div> <div class="side-column"> <div class="categories"> <h4>Tags</h4> <ul> <li><a href="/blog/tags/robots/">Robots</a></li> <li><a href="/blog/tags/events/">Events</a></li> </ul> </div> <div class="network"> <h4>Network</h4> <div class="network-links"> <a href="https://twitter.com/gobotio"><img src="/images/elements/twitter.png"></a> <a href="https://github.com/hybridgroup/gobot"><img src="/images/elements/github.png"></a> </div> </div> <div class="titles"> <h4>Posts</h4> <ul> <li><a href="/blog/2018/05/31/gobot-1.11/">Gobot - Release 1.11</a></li> <li><a href="/blog/2018/04/20/hello-tello-hacking-drones-with-go/">Hello, Tello - Hacking Drones With Go</a></li> <li><a href="/blog/2017/10/23/eyes-of-the-world/">Gobot 1.7 - Eyes Of The World</a></li> <li><a href="/blog/2017/05/10/gobot-1.5-on-pins-and-boards/">Gobot 1.5 - On Pins And Boards</a></li> <li><a href="/blog/2017/04/13/gobot-1.4-spring-cleaning/">Gobot - 1.4 Spring Cleaning</a></li> <li><a href="/blog/2017/03/22/gobot-1.3-is-here/">Gobot - 1.3 Is Here</a></li> <li><a href="/blog/2017/03/12/all-about-the-next-generation-at-scale15x/">All About The Next Generation At SCaLE15x</a></li> <li><a href="/blog/2017/02/16/gobot-1.2-released/">Gobot - 1.2 Released</a></li> <li><a href="/blog/2017/02/09/gobot-at-fosdem-2017/">Gobot At FOSDEM 2017</a></li> <li><a href="/blog/2017/01/09/gobot-1.1/">Gobot - The 1.1 Release</a></li> <li><a href="/blog/2016/12/21/gobot-the-big-one-oh/">Gobot - The Big One Oh!</a></li> <li><a href="/blog/2016/02/17/gobot-this-one-goes-to-0.11/">Gobot - This One Goes To 0.11</a></li> <li><a href="/blog/2015/10/27/gobot-0.10-less-is-more/">Gobot 0.10 - Less Is More</a></li> <li><a href="/blog/2015/09/14/gobot-vice/">Gobot in Vice</a></li> <li><a href="/blog/2015/09/01/gobot-in-sdtimes/">Gobot mentioned in SD Times</a></li> <li><a href="/blog/2015/04/13/gobot-featured-in-wired/">Gobot featured in Wired</a></li> <li><a href="/blog/2014/12/24/gobot-0.8/">Gobot 0.8 - The Happy Holiday Release</a></li> <li><a href="/blog/2014/11/11/gobot-0.7/">Gobot 0.7 - The Big Release</a></li> <li><a href="/blog/2014/09/24/run-golang-on-the-intel-edison-with-gobot/">Run Golang On The Intel Edison With Gobot</a></li> <li><a href="/blog/2014/08/08/flying-iris-at-distill-2014/">Flying Iris At Distill 2014</a></li> <li><a href="/blog/2014/07/11/gobot-0.6/">Gobot 0.6 is out!</a></li> <li><a href="/blog/2014/06/18/gobot-0.5/">Gobot 0.5 is out!</a></li> <li><a href="/blog/2014/04/29/taking-the-stage-at-gophercon/">Taking The Stage At GopherCon</a></li> <li><a href="/blog/2014/04/10/national-robotics-week-at-boston-golang/">National Robotics Week at Boston Golang</a></li> <li><a href="/blog/2013/10/21/go-gobot-go-golang-powered-robotics/">Go, Gobot, Go! Golang Powered Robotics</a></li> </ul> </div> </div> </div> </div> <footer class="app-footer"> <div class="grass-footer"></div> <div class="frameworks"> <div class="container"> <div class="column-footer"> <div class="img"> <img src="/images/elements/gobot-home.png"> </div> <p class="footer-description">Gobot provides a simple, yet powerful way to create solutions that incorporate multiple, different hardware devices at the same time.</p> </div> <div class="column-footer"> <div class="img"> <img src="/images/elements/artoo.png"> </div> <p class="footer-description">Want to use Ruby on robots? Check out our sister project Artoo</p> <div class="footer-button"> <a target="blank" href="http://artoo.io">View Project</a> </div> </div> <div class="column-footer"> <div class="img"> <img src="/images/elements/cylon.png"> </div> <p class="footer-description">Want to use Javascript to power your robots? Check out our sister project Cylon.js</p> <div class="footer-button"> <a target="blank" href="http://cylonjs.com">View Project</a> </div> </div> <div class="clear"></div> </div> </div> <div class="copyright"> <div class="container"> <div class="hybrid-group"> <span>© Copyright 2012-2018</span> <a href="http://hybridgroup.com" id="THG-logo" target="_blank"> <img alt="The Hybrid Group" src="/images/elements/THG_logo.png"> </a> </div> <div class="top-link"> <a href="#top"> <img alt="Top" src="/images/elements/triangle_up.svg"> <p>Top</p> </a> </div> <div class="clear"></div> </div> </div> </footer> </body> </html>
